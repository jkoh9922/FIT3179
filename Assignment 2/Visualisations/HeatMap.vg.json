{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {"url": "https://raw.githubusercontent.com/jkoh9922/FIT3179/main/Assignment%202/Data/Air%20Pollutant.csv"},
    "transform": [
      {
        "joinaggregate": [{"op": "sum", "field":"Value","as": "pol_val"}],
        "groupby": ["Country Label", "Pollutant"]
      },
      {
        "joinaggregate": [{"op": "count", "field":"Pollutant","as": "pol_co"}],
        "groupby": ["Country Label", "Pollutant"]
      },
      {
        "calculate": "(datum.pol_val/datum.pol_co)",
        "as": "pol"
      }
    ],
    "encoding": {
      "y": {"field": "Country Label", "type": "ordinal","title":"Countries"},
      "x": {"field": "Pollutant", "type": "ordinal","title":"Pollutants"}
    },
    "layer": [
      {
        "mark": "rect",
        "encoding": {
          "color": {
            "field": "pol",
            "type": "quantitative",
            "title": "Count of Records",
            "legend": {"direction": "vertical", "gradientLength": 200},
            "scale": {
              "type": "threshold",
              "domain": [0, 10, 100, 1000]
             
            }
          }
        }
      },
      {
        "mark": "text",
        "encoding": {
          "text": {"field": "pol", "type": "quantitative","format": ".2f"},
          "color": {
            "condition": {"test": "datum['pol'] < 100", "value": "black"},
            "value": "white"
          }
          
        }     
      }
    ],
    "config": {
      "scale": {
        "bandPaddingInner": 0,
        "bandPaddingOuter": 0
      },
      "view": {"step": 60},
      "range": {
        "ramp": {
          "scheme": "yellowgreenblue"
        }
      },
      "axis": {
        "domain": false
      }
    }
    
  }
  